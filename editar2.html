<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Datos de Usuario</title>
</head>
<body>
    <h1>Editar Datos del Usuario</h1>
    <div id="userData">
        <label for="username">Nombre de usuario:</label><br>
        <input type="text" id="username" name="username"><br>
        
        <label for="nombre">Nombre:</label><br>
        <input type="text" id="nombre" name="nombre"><br>
        
        <label for="correo">Correo Electrónico:</label><br>
        <input type="email" id="correo" name="correo"><br>
        
        <label for="telefono">Teléfono:</label><br>
        <input type="tel" id="telefono" name="telefono"><br>
        
        <label for="localidad">Localidad:</label><br>
        <input type="text" id="localidad" name="localidad"><br>
        
        <label for="club">Club:</label><br>
        <input type="text" id="club" name="club"><br>
        <!-- Puedes agregar más campos aquí según la estructura de tu tabla de usuarios -->
        
        <button onclick="guardarCambios()">Guardar Cambios</button>
    </div>

    <button class="borrar-cuenta" id="btn-borrar-cuenta">BORRAR CUENTA</button>

            <dialog id="modal">
                <h1 class="h1nombre">¿Estás seguro/a que quieres eliminar esta carrera permanentemente?</h1>
                <form action="#" method="post" id="carrera-form">
                    <input type="button" value="Cancelar" class="cuadro" id="btn-cancelar">
                    <input type="button" value="Borrar" class="cuadro" id="btn-borrar">
                </form>
            </dialog>

    <script src="./JS/editarusuario.js"></script>

    <!-- <script>
        document.addEventListener("DOMContentLoaded", function () {
    // Obtener el token JWT del localStorage
    let token = localStorage.getItem("miToken");

    if (token) {
        console.log("Token almacenado en el localStorage:", token); // Comprobar almacenamiento del token

        // Realizar una solicitud para obtener los datos del usuario usando el token
        fetchUserData(token);
    } else {
        // Si no hay token en el localStorage
        console.error("No hay token almacenado en localStorage");
    }
});

function fetchUserData(token) {
    // Realizar una solicitud para obtener y actualizar los datos del usuario usando el token
    fetch("./PHP/editar.php?miToken=" + token)
        .then(response => response.json())
        .then(data => {
            // Rellenar los campos de input con los datos del usuario
            if (data.error) {
                console.error("Error al obtener los datos del usuario:", data.error);
            } else {
                document.getElementById("username").value = data.username;
                document.getElementById("nombre").value = data.nombre;
                document.getElementById("correo").value = data.correo;
                document.getElementById("telefono").value = data.telefono;
                document.getElementById("localidad").value = data.localidad;
                document.getElementById("club").value = data.club;
                // Puedes agregar más campos aquí según la estructura de tu tabla de usuarios
            }
        })
        .catch(error => {
            console.error("Error al obtener los datos del usuario:", error);
        });
}

function guardarCambios() {
    console.log("guardarCambios() se está ejecutando"); // Comprobar ejecución de la función

    // Obtener el token del localStorage
    let token = localStorage.getItem("miToken");

    // Comprobar si el token está presente
    if (!token) {
        console.error("No hay token almacenado en localStorage");
        return;
    }

    // Obtener los valores de los inputs
    let username = document.getElementById("username").value;
    let nombre = document.getElementById("nombre").value;
    let correo = document.getElementById("correo").value;
    let telefono = document.getElementById("telefono").value;
    let localidad = document.getElementById("localidad").value;
    let club = document.getElementById("club").value;

    // Construir el objeto con los datos actualizados
    let userData = {
        username: username,
        nombre: nombre,
        correo: correo,
        telefono: telefono,
        localidad: localidad,
        club: club,
    };

    // Comprobar si el token se está agregando correctamente al objeto userData
    console.log("Datos a enviar al backend:", userData);

    // Realizar una solicitud para guardar los cambios
    fetch("./PHP/editar.php?miToken=" + token, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(userData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log("Cambios guardados exitosamente");
            // Puedes mostrar un mensaje de éxito o redirigir a otra página
        } else {
            console.error("Error al guardar los cambios:", data.error);
        }
    })
    .catch(error => {
        console.error("Error al guardar los cambios:", error);
    });
}

    </script> -->
</body>
</html>
